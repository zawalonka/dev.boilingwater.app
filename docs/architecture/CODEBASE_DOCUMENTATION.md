# Boiling Water App - Codebase Documentation

> **Last Updated:** 2026-01-31  
> **Status:** Pre-Alpha  
> **Load on-demand:** Only reference when debugging specific systems

---

## Overview

Educational physics game teaching thermodynamics through interactive boiling simulation. Uses **real physics equations** — no game physics simplifications.

**Tech Stack:** React + Vite  
**Resolution:** Fixed 1280×800px game window

---

## Core Components

### `src/components/GameScene.jsx` - Main Game Component
The heart of the application. Handles all gameplay logic including:
- Pot dragging with pointer capture
- Physics simulation loop (100ms intervals)
- Substance loading and switching
- Temperature and boiling detection
- Workshop theme application

**Key State:**
- `liquidMass` - Current liquid in pot (kg)
- `temperature` - Current temperature (°C)
- `altitude` - Current altitude (m)
- `fluidProps` - Loaded substance properties
- `isBoiling` - Has reached boiling point

### `src/components/ControlPanel.jsx` - Status & Controls
Extracted from GameScene for maintainability. Displays:
- Temperature, boiling point, timer
- Speed controls (pause, 1x-256x, 1/256x)
- Substance selector dropdown
- Altitude display + location popup trigger
- Extrapolation warning (when outside Antoine range)

### `src/components/Header.jsx` - Navigation
Minimal header with level/experiment dropdowns.

---

## Physics System

### `src/utils/physics.js` - Physics Engine

#### `calculatePressure(altitude)` - ISA Troposphere Model
Uses International Standard Atmosphere for accurate pressure:
```
T = T₀ - L × h  (temperature decreases with altitude)
P = P₀ × (T/T₀)^(g×M/(R×L))
```
- Sea level: 101,325 Pa
- 10,000m: 26,437 Pa
- Water boils at 66.3°C at 10km (not 69.9°C with old formula)

#### `solveAntoineEquation(pressurePa, antoineCoeffs)` - Vapor Pressure
Solves Antoine equation for boiling point:
```
T = B / (A - log₁₀(P_mmHg)) - C
```
- Returns `{ temperature, isExtrapolated, verifiedRange }`
- No TminC/TmaxC clamping — returns computed value always
- UI shows warning when extrapolating beyond verified range

#### `calculateBoilingPoint(altitude, fluidProps)` - Dynamic Calculation
1. Get pressure at altitude (ISA model)
2. Solve Antoine equation for base boiling point
3. Calculate dynamic Kb: `Kb = (R × Tb² × Msolvent) / ΔHvap`
4. Apply mixture elevation: `ΔTb = i × Kb × m`
5. Return final temperature + metadata

#### `simulateTimeStep(state, heatInputWatts, deltaTime, fluidProps)`
Main simulation loop:
- Applies heating energy: `Q = mcΔT`
- Checks boiling point (altitude-adjusted)
- Applies Newton's Law of Cooling when heat off
- Handles evaporation at boiling

### `src/constants/physics.js` - Universal Constants
**Only universal constants** — substance-specific data in JSON:
- `ATMOSPHERE.STANDARD_PRESSURE` = 101,325 Pa
- `UNIVERSAL.GAS_CONSTANT` = 8.314 J/(mol·K)
- `GAME_CONFIG.GAS_BURNER_WATTS` = 1,700 W

---

## Substance System

### Data Structure
```
src/data/substances/
├── compounds/
│   ├── pure/{compound}/info.json + {phase}/state.json
│   └── solutions/{solution}/info.json + liquid/state.json
└── periodic-table/001_H_nonmetal.json ... 118_Og_nonmetal.json
```

### `src/utils/substanceLoader.js` - Loading API
```javascript
// Load and parse substance for physics
const props = await loadSubstancePhase('water', 'liquid')

// Get available substances
const list = getAvailableSubstances()  // { compounds, elements, all }
```

### `src/utils/substanceParser.js` - Data Transformation
Extracts physics-ready values from JSON:
- `boilingPointSeaLevel`, `meltingPoint`
- `specificHeat`, `heatOfVaporization`
- `antoineCoefficients` (A, B, C, TminC, TmaxC)
- `vanHoffFactor`, `molality` (for solutions)

### `src/generated/substanceCatalog.js` - Auto-Generated
Build-time generated catalog mapping IDs to import paths.
**Never edit manually** — regenerated by `npm run dev/build`.

---

## Workshop System

### Structure
```
public/assets/workshops/{workshop-id}/
├── workshop.json    # Colors, images, metadata
└── effects.json     # Optional: steam, flame glow settings
```

### `src/utils/workshopLoader.js`
- Loads workshop JSON on demand
- Applies CSS variables for theming
- Validates flexible name field (top-level or metadata.name)
- Normalizes effects (default disabled if no effects.json)

---

## Key Formulas

### Boiling Point at Altitude
```
P = P₀ × (T/T₀)^5.2559           # ISA pressure
T_boil = B / (A - log₁₀(P)) - C  # Antoine equation
```

### Dynamic Ebullioscopic Constant
```
Kb = (R × Tb² × Msolvent) / ΔHvap
```
- At 100°C: Kb ≈ 0.512 °C·kg/mol
- At 66°C: Kb ≈ 0.424 °C·kg/mol

### Boiling Point Elevation (Solutions)
```
ΔTb = i × Kb × m
```
- i = van't Hoff factor (1.9 for NaCl)
- m = molality (mol solute / kg solvent)

### Newton's Law of Cooling
```
dT/dt = -k(T - T_ambient)
```

---

## File Quick Reference

| File | Purpose |
|------|---------|
| `GameScene.jsx` | Main game, physics loop, pot dragging |
| `ControlPanel.jsx` | UI controls, status display |
| `physics.js` | ISA model, Antoine, heating/cooling |
| `substanceLoader.js` | Load substances from JSON |
| `substanceParser.js` | Parse JSON to physics format |
| `workshopLoader.js` | Load and apply workshop themes |
| `constants/physics.js` | Universal constants only |
| `constants/workshops.js` | Level/experiment definitions |

---

## Common Debugging

### Boiling point seems wrong
1. Check altitude setting
2. Verify substance has Antoine coefficients
3. Check if extrapolation warning showing
4. Run ISA pressure calculation manually

### Substance not loading
1. Check `src/generated/substanceCatalog.js` was regenerated
2. Verify file path matches catalog
3. Check browser console for import errors

### Workshop theme not applying
1. Verify workshop.json exists in public/assets/workshops/
2. Check browser console for validation errors
3. Ensure name field exists (top-level or metadata.name)

