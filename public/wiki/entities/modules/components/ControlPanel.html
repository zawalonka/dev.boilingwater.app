<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ControlPanel.jsx</title>
  <link rel="stylesheet" href="/wiki/assets/styles.css" />
</head>
<body>
  <div class="wiki-layout">
    <div class="wiki-main">
      <header class="wiki-topbar">
        <details class="wiki-menu" aria-label="Menu">
          <summary>‚ò∞</summary>
          <nav class="wiki-menu-links">
            <a href="/wiki/index.html">Main page</a>
            <a href="/wiki/entities/elements/index.html">Elements</a>
            <a href="/wiki/entities/compounds/index.html">Compounds</a>
            <a href="/wiki/entities/solutions/index.html">Solutions</a>
            <a href="/wiki/entities/phases/index.html">Phases</a>
            <a href="/wiki/entities/levels/index.html">Levels</a>
            <a href="/wiki/entities/experiments/index.html">Experiments</a>
            <a href="/wiki/entities/formulas/index.html">Formulas</a>
            <a href="/wiki/entities/processes/index.html">Processes</a>
            <a href="/wiki/entities/modules/index.html">Modules</a>
            <a href="/wiki/entities/symbols/index.html">Symbols</a>
            <a href="/wiki/entities/public/index.html">Public Files</a>
            <div class="wiki-menu-divider"></div>
            <a href="/">Back to Game</a>
          </nav>
        </details>
        <div class="wiki-topbar-title">ControlPanel.jsx</div>
      </header>
      <main class="wiki-content">
        <article class="wiki-article">
          
      
    <aside class="infobox">
      <div class="infobox-title">ControlPanel.jsx</div>
      
      <div class="infobox-row">
        <div class="infobox-label">Type</div>
        <div class="infobox-value">React Component</div>
      </div>
    
      <div class="infobox-row">
        <div class="infobox-label">File type</div>
        <div class="infobox-value">jsx</div>
      </div>
    
      <div class="infobox-row">
        <div class="infobox-label">Imported by</div>
        <div class="infobox-value"><ul><li><a href="/wiki/entities/modules/components/GameScene.html">GameScene.jsx</a></li></ul></div>
      </div>
    
    </aside>
  
      <section class="section">
        
  <div class="entity-header">
    <h1>ControlPanel.jsx</h1>
    <p class="subtitle">React Component</p>
  </div>

      </section>
      
    <section class="section">
      <h2>Educational notes</h2>
      <p>ControlPanel Component</p>
<p>Displays the interactive status panel with controls for the game:</p>
<p>- Temperature and substance info</p>
<p>- Timer with start/stop/reset controls</p>
<p>- Speed controls (basic and advanced modes)</p>
<p>- Fluid selector dropdown</p>
<p>- Heat level controls</p>
<p>- Boiling status messages</p>
<p>- Altitude/location selection</p>
<p>All state management remains in GameScene; this component is purely presentational.</p>
    </section>
  
      <section class="section">
        <h2>Source file</h2>
        <p><code>src\components\ControlPanel.jsx</code></p>
        <details>
          <summary>View source code</summary>
          <pre class="code">/**
 * ControlPanel Component
 * 
 * Displays the interactive status panel with controls for the game:
 * - Temperature and substance info
 * - Timer with start/stop/reset controls
 * - Speed controls (basic and advanced modes)
 * - Fluid selector dropdown
 * - Heat level controls
 * - Boiling status messages
 * - Altitude/location selection
 * 
 * All state management remains in GameScene; this component is purely presentational.
 */

function ControlPanel({
  // Game state
  liquidMass,
  temperature,
  isBoiling,
  residueMass,
  fluidName,
  boilingPoint,
  canBoil,
  isPotOverFlame,
  expectedBoilTime,
  formatTemperature,
  ambientTemperature,
  
  // Extrapolation warning data
  isBoilingPointExtrapolated,
  boilingPointVerifiedRange,
  
  // UI state
  timeSpeed,
  isTimerRunning,
  timeElapsed,
  activeExperiment,
  activeFluid,
  availableFluids,
  isAdvancedModeAvailable,
  altitude,
  locationName,
  showLocationPopup,
  isLocationPopupAllowed,
  locationError,
  isLoadingLocation,
  userZipCode,
  manualAltitude,
  editableAltitude,
  showNextLevelButton,
  
  // Config
  burnerHeat,
  wattageSteps,
  GAME_CONFIG,
  
  // Callbacks
  handleTimerToggle,
  handleTimerReset,
  handleSpeedUp,
  handleSpeedDouble,
  handleSpeedHalve,
  handleQuickPause,
  handleFluidChange,
  handleNextProgression,
  nextProgressionType,
  handleSearchLocation,
  handleSetManualAltitude,
  handleFindMyLocation,
  onLocationChange,
  setEditableAltitude,
  setShowLocationPopup,
  setUserZipCode,
  setManualAltitude,
  setLocationError,
  setLocationName,
  setIsLoadingLocation,
  setHasSetLocation
}) {
  // Format time in mm:ss
  const formatTime = (seconds) =&gt; {
    if (seconds === null || seconds === undefined) return &#39;--:--&#39;
    const mins = Math.floor(seconds / 60)
    const secs = Math.floor(seconds % 60)
    return `${mins}:${secs.toString().padStart(2, &#39;0&#39;)}`
  }

  // Format speed display (handle fractional speeds like 1/2, 1/4, etc.)
  const formatSpeed = (speed) =&gt; {
    if (speed === 0) {
      return &#39;‚è∏ Pause&#39;
    }
    if (speed &gt;= 1) {
      return `${Math.round(speed)}x`
    }
    // For fractional speeds, show as 1/N
    const denominator = Math.round(1 / speed)
    return `1/${denominator}x`
  }

  return (
    &lt;&gt;
      {/* 
        ========== FLOATING STATUS PANEL ==========
        Combined info panel showing temperature, water status, and game info
        Floats outside game scene, positioned top-right below header
      */}
      &lt;div className=&quot;status-panel&quot;&gt;
        &lt;div className=&quot;status-content&quot;&gt;
          {/* Ambient/Room temperature */}
          &lt;div className=&quot;status-item&quot;&gt;
            &lt;span className=&quot;label&quot;&gt;Ambient:&lt;/span&gt;
            &lt;span className=&quot;value&quot;&gt;{formatTemperature(ambientTemperature ?? GAME_CONFIG.ROOM_TEMPERATURE)}¬∞C&lt;/span&gt;
          &lt;/div&gt;
          
          {/* Temperature display */}
          {liquidMass &gt; 0 &amp;&amp; (
            &lt;div className=&quot;status-item&quot;&gt;
              &lt;span className=&quot;label&quot;&gt;Temp:&lt;/span&gt;
              &lt;span className=&quot;value&quot;&gt;{formatTemperature(temperature)}¬∞C&lt;/span&gt;
            &lt;/div&gt;
          )}
          
          {/* Substance status */}
          &lt;div className=&quot;status-item&quot;&gt;
            &lt;span className=&quot;label&quot;&gt;Substance:&lt;/span&gt;
            &lt;span className=&quot;value&quot;&gt;{fluidName}&lt;/span&gt;
          &lt;/div&gt;

          &lt;div className=&quot;status-item&quot;&gt;
            &lt;span className=&quot;label&quot;&gt;Liquid:&lt;/span&gt;
            &lt;span className=&quot;value&quot;&gt;{liquidMass &gt; 0 ? liquidMass.toFixed(2) + &#39;kg&#39; : &#39;Empty&#39;}&lt;/span&gt;
          &lt;/div&gt;

          {residueMass &gt; 0 &amp;&amp; (
            &lt;div className=&quot;status-item&quot;&gt;
              &lt;span className=&quot;label&quot;&gt;Residue:&lt;/span&gt;
              &lt;span className=&quot;value&quot;&gt;{Math.round(residueMass * 1000)}g&lt;/span&gt;
            &lt;/div&gt;
          )}
          
          {/* Boiling point info */}
          &lt;div className=&quot;status-item&quot;&gt;
            &lt;span className=&quot;label&quot;&gt;Boils at:&lt;/span&gt;
            &lt;span className=&quot;value&quot;&gt;{canBoil ? `${formatTemperature(boilingPoint, 2)}¬∞C` : &#39;N/A&#39;}&lt;/span&gt;
          &lt;/div&gt;
          
          {/* Extrapolation warning - shows when boiling point is outside verified Antoine range */}
          {isBoilingPointExtrapolated &amp;&amp; canBoil &amp;&amp; (
            &lt;div className=&quot;status-item extrapolation-warning&quot; title=&quot;The boiling point calculation is outside the empirically verified temperature range for this substance. Results are estimated and may have reduced accuracy.&quot;&gt;
              &lt;span className=&quot;label&quot;&gt;‚ö†Ô∏è&lt;/span&gt;
              &lt;span className=&quot;value warning-text&quot;&gt;
                {boilingPointVerifiedRange?.max !== null &amp;&amp; boilingPoint &gt; boilingPointVerifiedRange.max
                  ? `Above verified range (${formatTemperature(boilingPointVerifiedRange.max, 0)}¬∞C)`
                  : boilingPointVerifiedRange?.min !== null &amp;&amp; boilingPoint &lt; boilingPointVerifiedRange.min
                    ? `Below verified range (${formatTemperature(boilingPointVerifiedRange.min, 0)}¬∞C)`
                    : &#39;Outside verified range&#39;}
              &lt;/span&gt;
            &lt;/div&gt;
          )}
          
          {/* Timer controls - prominent display with start/stop/reset (Advanced Mode Only) */}
          {isAdvancedModeAvailable &amp;&amp; (
            &lt;div className=&quot;timer-controls&quot;&gt;
              &lt;div className=&quot;timer-display&quot;&gt;
                &lt;span className=&quot;timer-label&quot;&gt;Timer:&lt;/span&gt;
                &lt;span className=&quot;timer-value&quot;&gt;{formatTime(timeElapsed)}&lt;/span&gt;
              &lt;/div&gt;
              &lt;div className=&quot;timer-buttons&quot;&gt;
                &lt;button 
                  className=&quot;timer-button&quot;
                  onClick={handleTimerToggle}
                  title={isTimerRunning ? &quot;Pause timer&quot; : &quot;Start timer&quot;}
                &gt;
                    {isTimerRunning ? &#39;‚è∏&#39; : &#39;‚ñ∂&#39;}
                &lt;/button&gt;
                &lt;button 
                  className=&quot;timer-button&quot;
                  onClick={handleTimerReset}
                  title=&quot;Reset timer to zero&quot;
                &gt;
                    ‚Üª
                &lt;/button&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          )}
          
          {/* Expected time to boil (environmental estimate) */}
          {liquidMass &gt; 0 &amp;&amp; expectedBoilTime !== null &amp;&amp; !isBoiling &amp;&amp; (
            &lt;div className=&quot;status-item&quot; title=&quot;Estimated time to reach boiling point at current burner setting&quot;&gt;
              &lt;span className=&quot;label&quot;&gt;Est. Time:&lt;/span&gt;
              &lt;span className=&quot;value&quot;&gt;{formatTime(expectedBoilTime)}&lt;/span&gt;
            &lt;/div&gt;
          )}
          
          {/* Fluid selector (Exp 3+: different-fluids and beyond) */}
          {activeExperiment !== &#39;boiling-water&#39; &amp;&amp; activeExperiment !== &#39;altitude-effect&#39; &amp;&amp; availableFluids.length &gt; 0 &amp;&amp; (
            &lt;div className=&quot;fluid-selector&quot;&gt;
              &lt;label htmlFor=&quot;fluid-select&quot;&gt;Fluid:&lt;/label&gt;
              &lt;select 
                id=&quot;fluid-select&quot;
                value={activeFluid}
                onChange={handleFluidChange}
                className=&quot;fluid-dropdown&quot;
                title=&quot;Select which fluid to boil&quot;
              &gt;
                {availableFluids.map(fluidId =&gt; (
                  &lt;option key={fluidId} value={fluidId}&gt;
                    {fluidId.charAt(0).toUpperCase() + fluidId.slice(1).replace(/-/g, &#39; &#39;)}
                  &lt;/option&gt;
                ))}
              &lt;/select&gt;
            &lt;/div&gt;
          )}

          {/* Game controls - speed controls (Tutorial/Exp 1 only) */}
          {liquidMass &gt; 0 &amp;&amp; activeExperiment === &#39;boiling-water&#39; &amp;&amp; (
            &lt;button 
              className=&quot;action-button speed-button status-button&quot;
              onClick={handleSpeedUp}
            &gt;
              ‚ö° Speed: {formatSpeed(timeSpeed)}
            &lt;/button&gt;
          )}
          
          {/* Advanced speed controls with arrows (Advanced Mode Only) */}
          {isAdvancedModeAvailable &amp;&amp; (
            &lt;&gt;
              &lt;div className=&quot;speed-warning&quot;&gt;
                ‚ö†Ô∏è High speeds (256x+) produce inaccurate physics. Results are experimental.
              &lt;/div&gt;
              &lt;div className=&quot;speed-controls-advanced&quot;&gt;
              &lt;button 
                className=&quot;speed-arrow&quot;
                onClick={handleSpeedHalve}
                title=&quot;Halve speed&quot;
              &gt;
                ‚óÄ
              &lt;/button&gt;
              &lt;button 
                className=&quot;speed-arrow&quot;
                onClick={handleQuickPause}
                title={timeSpeed === 0 ? &quot;Resume&quot; : &quot;Pause&quot;}
              &gt;
                {timeSpeed === 0 ? &#39;‚ñ∂&#39; : &#39;‚è∏&#39;}
              &lt;/button&gt;
              &lt;span className=&quot;speed-display&quot;&gt;‚ö° {formatSpeed(timeSpeed)}&lt;/span&gt;
              &lt;button 
                className=&quot;speed-arrow&quot;
                onClick={handleSpeedDouble}
                title=&quot;Double speed&quot;
              &gt;
                ‚ñ∂
              &lt;/button&gt;
              &lt;/div&gt;
            &lt;/&gt;
          )}
          
          {/* Heating status with progress */}
          {liquidMass &gt; 0 &amp;&amp; burnerHeat &gt; 0 &amp;&amp; isPotOverFlame &amp;&amp; canBoil &amp;&amp; temperature &lt; boilingPoint &amp;&amp; (
            &lt;p className=&quot;status-text&quot; title=&quot;Wait for the fluid to boil, or speed up time with the speed controls above&quot;&gt;
              üî• Heating: {formatTemperature(temperature, 2)}¬∞C ‚Üí {formatTemperature(boilingPoint, 2)}¬∞C
            &lt;/p&gt;
          )}

          {liquidMass &gt; 0 &amp;&amp; burnerHeat &gt; 0 &amp;&amp; isPotOverFlame &amp;&amp; !canBoil &amp;&amp; (
            &lt;p className=&quot;status-text&quot; title=&quot;This substance has no boiling data, so it won&#39;t boil&quot;&gt;
              üî• Heating: {formatTemperature(temperature)}¬∞C (no boiling point data)
            &lt;/p&gt;
          )}
          
          {/* Cooling - pot is off the flame */}
          {liquidMass &gt; 0 &amp;&amp; burnerHeat &gt; 0 &amp;&amp; !isPotOverFlame &amp;&amp; temperature &gt; (ambientTemperature ?? GAME_CONFIG.ROOM_TEMPERATURE) &amp;&amp; (
            &lt;p className=&quot;status-text&quot; title=&quot;Position pot over flame to heat the fluid&quot;&gt;
              ‚ùÑÔ∏è Cooling: {formatTemperature(temperature)}¬∞C ‚Üí {formatTemperature(ambientTemperature ?? GAME_CONFIG.ROOM_TEMPERATURE)}¬∞C (place pot over flame)
            &lt;/p&gt;
          )}
          
          {/* Waiting to heat */}
          {liquidMass &gt; 0 &amp;&amp; burnerHeat === 0 &amp;&amp; (!canBoil || temperature &lt; boilingPoint) &amp;&amp; (
            &lt;p className=&quot;status-text&quot;&gt;
              üí§ Turn on burner to heat the fluid
            &lt;/p&gt;
          )}
          
          {/* Boiling status with water level */}
          {liquidMass &gt; 0 &amp;&amp; isBoiling &amp;&amp; canBoil &amp;&amp; temperature &gt;= boilingPoint &amp;&amp; (
            &lt;p className=&quot;status-text boiling&quot;&gt;
              üí® Boiling at {formatTemperature(temperature)}¬∞C! ({Math.round(liquidMass * 1000)}g remaining)
            &lt;/p&gt;
          )}
          
          {/* Water boiled off - can refill */}
          {liquidMass &lt;= 0.1 &amp;&amp; liquidMass &gt; 0 &amp;&amp; (
            &lt;p className=&quot;status-text warning&quot;&gt;
              ‚ö†Ô∏è Almost dry! Drag pot to tap to refill
            &lt;/p&gt;
          )}
          
          {/* Empty pot hint */}
          {liquidMass === 0 &amp;&amp; residueMass === 0 &amp;&amp; (
            &lt;p className=&quot;hint-text&quot;&gt;üíß Drag pot to water tap to fill&lt;/p&gt;
          )}

          {liquidMass === 0 &amp;&amp; residueMass &gt; 0 &amp;&amp; (
            &lt;p className=&quot;status-text warning&quot;&gt;
              üß™ Residue remaining: {Math.round(residueMass * 1000)}g
            &lt;/p&gt;
          )}

          {showNextLevelButton &amp;&amp; (
            &lt;button
              className=&quot;action-button continue-button&quot;
              onClick={handleNextProgression}
            &gt;
              {nextProgressionType === &#39;level&#39; ? &#39;Next Level ‚Üí&#39; : &#39;Next Experiment ‚Üí&#39;}
            &lt;/button&gt;
          )}

          {/* Altitude control (Exp 2+: altitude-effect and beyond) - bottom of panel */}
          {activeExperiment !== &#39;boiling-water&#39; &amp;&amp; (
            &lt;div className=&quot;altitude-control&quot;&gt;
              &lt;span className=&quot;altitude-display&quot;&gt;
                Altitude: {altitude.toLocaleString()}m
              &lt;/span&gt;
              {locationName ? (
                &lt;button 
                  className=&quot;action-button location-button&quot;
                  onClick={() =&gt; {
                    setShowLocationPopup(true)
                  }}
                  title=&quot;Change location&quot;
                &gt;
                  üìç {locationName}
                &lt;/button&gt;
              ) : (
                &lt;button 
                  className=&quot;action-button location-button&quot;
                  onClick={() =&gt; {
                    setShowLocationPopup(true)
                  }}
                  title=&quot;Set your location&quot;
                &gt;
                  üìç Set Location
                &lt;/button&gt;
              )}
            &lt;/div&gt;
          )}
        &lt;/div&gt;
      &lt;/div&gt;

      {/* 
        ========== LOCATION SETUP POPUP (Exp 2+) ==========
        Modal that appears when user enters an altitude-based experiment
        User must select a location or altitude to proceed
      */}
      {showLocationPopup &amp;&amp; isLocationPopupAllowed &amp;&amp; (
        &lt;div className=&quot;location-panel&quot;&gt;
          {/* Loading overlay */}
          {isLoadingLocation &amp;&amp; (
            &lt;div className=&quot;location-loading-overlay&quot;&gt;
              &lt;div className=&quot;location-loading-spinner&quot;&gt;‚è≥&lt;/div&gt;
              &lt;div className=&quot;location-loading-text&quot;&gt;Determining altitude from location...&lt;/div&gt;
            &lt;/div&gt;
          )}
          
          &lt;h3&gt;üìç Set Your Location&lt;/h3&gt;
          &lt;p className=&quot;location-subtitle&quot;&gt;
            Notice how the boiling point changes with altitude? Enter your location or altitude to test.
          &lt;/p&gt;

          {locationError &amp;&amp; (
            &lt;div className=&quot;location-error&quot;&gt;
              &lt;span className=&quot;error-icon&quot;&gt;‚ö†Ô∏è&lt;/span&gt;
              &lt;span className=&quot;error-text&quot;&gt;{locationError}&lt;/span&gt;
            &lt;/div&gt;
          )}

          &lt;div className=&quot;location-section&quot;&gt;
            &lt;label className=&quot;section-title&quot;&gt;Search for a Location (Worldwide)&lt;/label&gt;
            &lt;div className=&quot;location-inputs&quot;&gt;
              &lt;input
                type=&quot;text&quot;
                placeholder=&quot;City, landmark, or place (Death Valley, Mt Everest, Tokyo)&quot;
                value={userZipCode}
                onChange={(e) =&gt; {
                  setUserZipCode(e.target.value)
                  setLocationError(null)
                }}
                onKeyPress={(e) =&gt; e.key === &#39;Enter&#39; &amp;&amp; handleSearchLocation()}
                disabled={isLoadingLocation}
                className=&quot;location-input location-search-input&quot;
              /&gt;
              &lt;button
                onClick={handleSearchLocation}
                disabled={isLoadingLocation || !userZipCode.trim()}
                className=&quot;location-button&quot;
                title=&quot;Search worldwide&quot;
              &gt;
                {isLoadingLocation ? &#39;‚è≥&#39; : &#39;üîç&#39;}
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;div className=&quot;location-divider&quot;&gt;or&lt;/div&gt;

          &lt;div className=&quot;location-section&quot;&gt;
            &lt;label className=&quot;section-title&quot;&gt;Enter Altitude Manually&lt;/label&gt;
            &lt;div className=&quot;altitude-inputs&quot;&gt;
              &lt;input
                type=&quot;number&quot;
                placeholder=&quot;Meters (negative = below sea level)&quot;
                value={manualAltitude}
                onChange={(e) =&gt; {
                  setManualAltitude(e.target.value)
                  setLocationError(null)
                }}
                onKeyPress={(e) =&gt; e.key === &#39;Enter&#39; &amp;&amp; handleSetManualAltitude()}
                disabled={isLoadingLocation}
                className=&quot;altitude-input&quot;
              /&gt;
              &lt;button
                onClick={handleSetManualAltitude}
                disabled={isLoadingLocation || !manualAltitude.trim()}
                className=&quot;location-button&quot;
              &gt;
                ‚úì
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;div className=&quot;location-divider&quot;&gt;or&lt;/div&gt;

          &lt;div className=&quot;location-section&quot;&gt;
            &lt;button
              onClick={handleFindMyLocation}
              disabled={isLoadingLocation}
              className=&quot;location-button find-my-location&quot;
            &gt;
              {isLoadingLocation ? &#39;‚è≥ Getting your location...&#39; : &#39;üìç Use My Current Location&#39;}
            &lt;/button&gt;
            &lt;small className=&quot;location-help&quot;&gt;Uses browser geolocation (needs permission)&lt;/small&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      )}
    &lt;/&gt;
  )
}

export default ControlPanel
</pre>
        </details>
      </section>
    
        </article>
      </main>
    </div>
  </div>
</body>
</html>